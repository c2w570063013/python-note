import json
import base64
import urllib.request
import crawler.wx_sdk.wx_sdk as wx_sdk
import requests


def get_and_identify_v_code(v_code_url):
    url = 'https://way.jd.com/showapi/checkcode_ys'
    response = urllib.request.urlopen(v_code_url).read()
    base_64 = base64.b64encode(response)
    print(base_64)
    exit()
    body_str = 'img_base64=' + str(base_64, 'utf-8')
    params = {
        'typeId': '34',
        'convert_to_jpg': '0',
        'appkey': '1c4d515b1908c1700015b5d83855ea66'
    }
    response = wx_sdk.wx_post_req(url, params, bodyStr=body_str)
    return json.loads(response.text)['result']['showapi_res_body']['Result']

def test():
    post_data = {
        'ctl00$ScriptManager1': 'ctl00$ContentPlaceHolder1$updatepannel2|ctl00$ContentPlaceHolder1$btnnext',
        '__EVENTTARGET': 'ctl00$ContentPlaceHolder1$btnnext',
        '__VIEWSTATE': '/wEPDwULLTE0MjE2NTkzMzUPFggeB2N1cnBhZ2UCAx4IdG90YWxudW0CBh4IdG90YWxyb3cCTR4MbGV2ZWxkYXRhc2V0MtANAAEAAAD/////AQAAAAAAAAAMAgAAAE5TeXN0ZW0uRGF0YSwgVmVyc2lvbj0yLjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODkFAQAAABNTeXN0ZW0uRGF0YS5EYXRhU2V0AwAAABdEYXRhU2V0LlJlbW90aW5nVmVyc2lvbglYbWxTY2hlbWELWG1sRGlmZkdyYW0DAQEOU3lzdGVtLlZlcnNpb24CAAAACQMAAAAGBAAAAKcKPD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTE2Ij8+DQo8eHM6c2NoZW1hIGlkPSJOZXdEYXRhU2V0IiB4bWxucz0iIiB4bWxuczp4cz0iaHR0cDovL3d3dy53My5vcmcvMjAwMS9YTUxTY2hlbWEiIHhtbG5zOm1zZGF0YT0idXJuOnNjaGVtYXMtbWljcm9zb2Z0LWNvbTp4bWwtbXNkYXRhIj4NCiAgPHhzOmVsZW1lbnQgbmFtZT0iTmV3RGF0YVNldCIgbXNkYXRhOklzRGF0YVNldD0idHJ1ZSIgbXNkYXRhOlVzZUN1cnJlbnRMb2NhbGU9InRydWUiPg0KICAgIDx4czpjb21wbGV4VHlwZT4NCiAgICAgIDx4czpjaG9pY2UgbWluT2NjdXJzPSIwIiBtYXhPY2N1cnM9InVuYm91bmRlZCI+DQogICAgICAgIDx4czplbGVtZW50IG5hbWU9IlRhYmxlIj4NCiAgICAgICAgICA8eHM6Y29tcGxleFR5cGU+DQogICAgICAgICAgICA8eHM6c2VxdWVuY2U+DQogICAgICAgICAgICAgIDx4czplbGVtZW50IG5hbWU9Ik5fTEVWRUxfU0VRIiB0eXBlPSJ4czppbnQiIG1zZGF0YTp0YXJnZXROYW1lc3BhY2U9IiIgbWluT2NjdXJzPSIwIiAvPg0KICAgICAgICAgICAgICA8eHM6ZWxlbWVudCBuYW1lPSJDX0xFVkVMX0lEIiB0eXBlPSJ4czpzdHJpbmciIG1zZGF0YTp0YXJnZXROYW1lc3BhY2U9IiIgbWluT2NjdXJzPSIwIiAvPg0KICAgICAgICAgICAgICA8eHM6ZWxlbWVudCBuYW1lPSJDX0xFVkVMX0ZJRCIgdHlwZT0ieHM6c3RyaW5nIiBtc2RhdGE6dGFyZ2V0TmFtZXNwYWNlPSIiIG1pbk9jY3Vycz0iMCIgLz4NCiAgICAgICAgICAgICAgPHhzOmVsZW1lbnQgbmFtZT0iQ19MRVZFTF9OQU1FIiB0eXBlPSJ4czpzdHJpbmciIG1zZGF0YTp0YXJnZXROYW1lc3BhY2U9IiIgbWluT2NjdXJzPSIwIiAvPg0KICAgICAgICAgICAgICA8eHM6ZWxlbWVudCBuYW1lPSJDX0xFVkVMX1NOQU1FIiB0eXBlPSJ4czpzdHJpbmciIG1zZGF0YTp0YXJnZXROYW1lc3BhY2U9IiIgbWluT2NjdXJzPSIwIiAvPg0KICAgICAgICAgICAgICA8eHM6ZWxlbWVudCBuYW1lPSJDX0lGTEVBRiIgdHlwZT0ieHM6c3RyaW5nIiBtc2RhdGE6dGFyZ2V0TmFtZXNwYWNlPSIiIG1pbk9jY3Vycz0iMCIgLz4NCiAgICAgICAgICAgICAgPHhzOmVsZW1lbnQgbmFtZT0iTl9MRVZFTF9GU0VRIiB0eXBlPSJ4czppbnQiIG1zZGF0YTp0YXJnZXROYW1lc3BhY2U9IiIgbWluT2NjdXJzPSIwIiAvPg0KICAgICAgICAgICAgPC94czpzZXF1ZW5jZT4NCiAgICAgICAgICA8L3hzOmNvbXBsZXhUeXBlPg0KICAgICAgICA8L3hzOmVsZW1lbnQ+DQogICAgICA8L3hzOmNob2ljZT4NCiAgICA8L3hzOmNvbXBsZXhUeXBlPg0KICA8L3hzOmVsZW1lbnQ+DQo8L3hzOnNjaGVtYT4GBQAAAIABPGRpZmZncjpkaWZmZ3JhbSB4bWxuczptc2RhdGE9InVybjpzY2hlbWFzLW1pY3Jvc29mdC1jb206eG1sLW1zZGF0YSIgeG1sbnM6ZGlmZmdyPSJ1cm46c2NoZW1hcy1taWNyb3NvZnQtY29tOnhtbC1kaWZmZ3JhbS12MSIgLz4EAwAAAA5TeXN0ZW0uVmVyc2lvbgQAAAAGX01ham9yBl9NaW5vcgZfQnVpbGQJX1JldmlzaW9uAAAAAAgICAgCAAAAAAAAAP//////////CxYCZg9kFgICAw9kFgICAw9kFhRmDw8WBB4EVGV4dAUP5Y+v6YCJ5Li76LSm5Y+3HgdWaXNpYmxlaGRkAgEPEA8WAh8FaGQPFgFmFgEQBQg1MDA0Mjc0MgUINTAwNDI3NDJnFgFmZAIIDw8WAh4JTWF4TGVuZ3RoZmRkAgoPFhYeIEN1bHR1cmVDdXJyZW5jeVN5bWJvbFBsYWNlaG9sZGVyBQPvv6UeDkFjY2VwdE5lZ2F0aXZlCymCAUFqYXhDb250cm9sVG9vbGtpdC5NYXNrZWRFZGl0U2hvd1N5bWJvbCwgQWpheENvbnRyb2xUb29sa2l0LCBWZXJzaW9uPTEuMC4xMDYxOC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPTI4ZjAxYjBlODRiNmQ1M2UAHhZDdWx0dXJlVGltZVBsYWNlaG9sZGVyBQE6Hg5JbnB1dERpcmVjdGlvbgsphgFBamF4Q29udHJvbFRvb2xraXQuTWFza2VkRWRpdElucHV0RGlyZWN0aW9uLCBBamF4Q29udHJvbFRvb2xraXQsIFZlcnNpb249MS4wLjEwNjE4LjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49MjhmMDFiMGU4NGI2ZDUzZQAeDERpc3BsYXlNb25leQsrBAAeFkN1bHR1cmVBTVBNUGxhY2Vob2xkZXIFDeS4iuWNiDvkuIvljYgeEUN1bHR1cmVEYXRlRm9ybWF0BQNZTUQeFkN1bHR1cmVEYXRlUGxhY2Vob2xkZXIFAS0eG0N1bHR1cmVUaG91c2FuZHNQbGFjZWhvbGRlcgUBLB4KQWNjZXB0QW1QbWgeGUN1bHR1cmVEZWNpbWFsUGxhY2Vob2xkZXIFAS5kAg0PDxYCHwZmZGQCDw8WFh8HBQPvv6UfCAsrBAAfCQUBOh8KCysFAB8LCysEAB8MBQ3kuIrljYg75LiL5Y2IHw0FA1lNRB8OBQEtHw8FASwfEGgfEQUBLmQCEg9kFgJmD2QWAgIBDxBkEBUBABUBABQrAwFnZGQCFA9kFgJmD2QWAgIBDw8WAh8EBWog5raI6LS56YeR6aKdOu+/pTE5LDE0Ny44OO+8jOaKmOWQjumHkeminTrvv6UxOCwwMjEuOTDvvIzmn7TmsrnplIDph486MC4wMDDljYfvvIzmsb3msrnplIDph486Miw3ODYuMzI45Y2HZGQCFg9kFgJmD2QWAgIBDw8WBB4FV2lkdGgbAAAAAAAAWUAHAAAAHgRfIVNCAoACZGQCFw9kFgJmD2QWAgIBDw8WAh8EBUQg5YWx5p+l5Yiw5raI6LS55piO57uG5L+h5oGvNzfmnaHvvIzliIY26aG15pi+56S677yM5b2T5YmN5Li656ysM+mhtWRkGAEFHl9fQ29udHJvbHNSZXF1aXJlUG9zdEJhY2tLZXlfXxYCBSNjdGwwMCRDb250ZW50UGxhY2VIb2xkZXIxJGJ0bkltYWdlMQUjY3RsMDAkQ29udGVudFBsYWNlSG9sZGVyMSRidG5JbWFnZTKWqeYUEGsZ+GYxP4OW7wzP6FYdPA=='
    }
    headers = {
        'Cookie': 'ASP.NET_SessionId=tj0wsv55jcg1opuzeb0mkgzd',
        'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.94 Safari/537.36',
        'Content-Type': 'application/x-www-form-urlencoded',
        'Accept-Encoding': 'gzip, deflate'
    }
    res = requests.post('http://card.bppc.com.cn/WebConsumeDetail.aspx', data=post_data, headers=headers)
    html1 = res.text
    with open('xxx.html', 'w', encoding='utf-8') as fd:
        fd.write(html1)
